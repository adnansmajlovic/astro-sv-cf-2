---
export const prerender = false;

import BaseLayout from "../../layouts/BaseLayout.astro";
import { getEntryBySlug, getEntry } from "astro:content";

const slug = Astro.params.slug;

if (!slug) {
    return new Response("Not found", { status: 404 });
}

const post = await getEntryBySlug("blog", slug);

if (!post || post.data.draft) {
    return new Response("Not found", { status: 404 });
}

const { Content } = await post.render();
const author = await getEntry("authors", post.data.authorId);
---

<BaseLayout title={post.data.title} description={post.data.description}>
    <main class="mx-auto w-full max-w-3xl px-4 py-10 sm:px-6">
        <a
            href="/blog"
            class="inline-flex items-center gap-2 rounded-xl border border-slate-800 bg-slate-900/40 px-3 py-2 text-sm text-slate-200
             hover:border-slate-700 hover:bg-slate-900/60"
        >
            <span aria-hidden="true">←</span> Back
        </a>

        <article class="mt-6">
            <header class="mb-8">
                <h1 class="text-3xl font-semibold tracking-tight sm:text-4xl">
                    {post.data.title}
                </h1>

                <p
                    class="mt-3 text-lg leading-relaxed text-slate-300 sm:text-xl"
                >
                    {post.data.description}
                </p>

                <div
                    class="mt-5 flex flex-wrap items-center gap-x-3 gap-y-2 text-base text-slate-300"
                >
                    <span class="font-medium text-slate-200"
                        >{author?.data.name}</span
                    >
                    {
                        author?.data.title ? (
                            <span class="text-slate-500">·</span>
                        ) : null
                    }
                    {
                        author?.data.title ? (
                            <span>{author.data.title}</span>
                        ) : null
                    }
                    <span class="text-slate-500">·</span>
                    <time class="text-slate-400">
                        {post.data.pubDate.toLocaleDateString("en-CA")}
                    </time>
                </div>
            </header>

            <div
                class="max-w-none
                text-[18px] sm:text-[20px]
                leading-[1.75]
                text-[#c4c4bd]
                [&_p]:mb-5
                [&_p]:text-inherit
                [&_p]:leading-[1.75]
                [&_h2]:mt-9 [&_h2]:mb-4 [&_h2]:text-2xl [&_h2]:font-semibold [&_h2]:text-[#e7e7e3]
                [&_h3]:mt-7 [&_h3]:mb-3 [&_h3]:text-xl [&_h3]:font-semibold [&_h3]:text-[#e7e7e3]
                [&_strong]:text-[#e0e0db]
                [&_a]:text-[#9bbcf5]
                [&_a]:underline
                [&_a]:underline-offset-4"
            >
                <Content />
            </div>
        </article>
    </main>
</BaseLayout>
